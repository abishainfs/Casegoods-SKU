<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casegoods: SKU Generator</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F5F5F7;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 2rem;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Custom "Apple-like" color palette and layout */
        .bg-apple-primary { background-color: #1C1C1E; }
        .hover\:bg-apple-primary-dark:hover { background-color: #3A3A3C; }
        .focus\:ring-apple-blue:focus { --tw-ring-color: #007AFF; }
        .text-apple-dark { color: #1D1D1F; }
        .text-apple-medium { color: #3C3C43; }
        .bg-apple-light { background-color: #FFFFFF; }
        .bg-apple-section { background-color: #F9F9FB; }
        .border-apple-light-border { border-color: #E5E5EA; }
        .text-apple-accent { color: #007AFF; }

        .main-container {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            width: 100%;
            max-width: 1600px;
        }

        @media (min-width: 1024px) {
            .main-container {
                flex-direction: row;
                align-items: flex-start;
            }
            .main-form-card {
                flex: 2; /* Generator takes 2/3 of the space */
            }
            .sidebar-container {
                flex: 1; /* Sidebar takes 1/3 of the space */
                display: flex;
                flex-direction: column;
                gap: 2rem;
            }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="main-container">
        <!-- Main SKU Generation Form -->
        <div class="main-form-card bg-apple-light p-8 rounded-xl shadow-lg w-full border border-apple-light-border">
            <!-- Updated Logo -->
            <img src="Casegoods_Logo.jpg"
                 alt="Casegoods Logo"
                 class="mx-auto mb-6 h-12 rounded-lg shadow-sm"
                 onerror="this.onerror=null;this.src='https://placehold.co/150x50/CCCCCC/666666?text=LOGO+NOT+FOUND';"
            >
            <h1 class="text-3xl font-extrabold text-apple-dark mb-6 text-center">Casegoods: SKU Generator</h1>

            <!-- Instructions Dropdown -->
            <details class="mb-6 p-4 bg-apple-section border border-apple-light-border rounded-lg">
                <summary class="text-lg font-semibold text-apple-dark cursor-pointer">Quick Guide: SKU Generation</summary>
                <div class="mt-4 text-apple-medium text-sm leading-relaxed">
                    <p class="mb-2">This tool helps create unique SKUs (Stock Keeping Units). Our SKUs follow this format: <strong class="text-apple-dark">X-ABCD-EF-GH-IJ</strong></p>
                    <h4 class="font-bold text-apple-dark mb-2">Here's the simple breakdown:</h4>
                    <ul class="list-disc list-inside mb-3">
                        <li class="mb-1"><strong class="text-apple-dark">X - Product Category:</strong> Pick the product type from the dropdown.</li>
                        <li class="mb-1"><strong class="text-apple-dark">ABCD - Product Code:</strong> Select the product's unique code.</li>
                        <li class="mb-1"><strong class="text-apple-dark">EF - Size/Type:</strong> Enter a 2-digit number for the size or specific version (e.g., '01').</li>
                        <li class="mb-1"><strong class="text-apple-dark">GH & IJ - Materials:</strong> Select Material Type and its Finish. These are optional.</li>
                    </ul>
                </div>
            </details>

            <!-- SKU Generation Form -->
            <div class="flex flex-col md:flex-row gap-4 mb-6">
                <!-- Product Category, Code, and Size/Type on one line -->
                <div class="flex-1">
                    <label class="block text-sm font-medium text-apple-medium mb-1">Product Details</label>
                    <div class="flex flex-row gap-2">
                        <!-- Product Category (X) -->
                        <select id="productCategory" class="p-3 border border-apple-light-border rounded-lg focus:ring-apple-blue focus:border-apple-blue transition duration-150 ease-in-out">
                            <option value="" disabled selected>Cat</option>
                            <option value="F">F</option>
                            <option value="L">L</option>
                            <option value="O">O</option>
                            <option value="H">H</option>
                        </select>
                        <!-- Product Code (ABCD) -->
                        <select id="productCode" class="flex-grow p-3 border border-apple-light-border rounded-lg focus:ring-apple-blue focus:border-apple-blue transition duration-150 ease-in-out">
                            <option value="" disabled selected>Loading Products...</option>
                        </select>
                        <!-- Size/Type (EF) -->
                        <input type="text" id="sizeType" value="00" maxlength="2" class="p-3 w-16 border text-center border-apple-light-border rounded-lg focus:ring-apple-blue focus:border-apple-blue transition duration-150 ease-in-out">
                    </div>
                </div>
            </div>

            <!-- Dynamic Product Details Section -->
            <div id="productDetailsSection" class="hidden mb-4 p-4 border border-apple-light-border rounded-lg bg-apple-section text-sm text-apple-medium">
                <!-- Product specific details will be displayed here -->
            </div>

            <!-- Customisable Material 1 (GH) -->
            <div class="mb-4 p-4 border border-apple-light-border rounded-lg bg-apple-section">
                <h3 class="text-md font-semibold text-apple-dark mb-3">Customisable Material 1 (GH) <span class="text-gray-500 text-sm">(Optional)</span></h3>
                <div class="flex flex-col sm:flex-row gap-4">
                    <div class="flex-1">
                        <label for="material1Type" class="block text-sm font-medium text-apple-medium mb-1">Material Type (G)</label>
                        <select id="material1Type" class="w-full p-3 border border-apple-light-border rounded-lg focus:ring-apple-blue focus:border-apple-blue transition duration-150 ease-in-out">
                            <option value="" disabled selected>Loading Materials...</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label for="material1Finish" class="block text-sm font-medium text-apple-medium mb-1">Material Finish (H)</label>
                        <select id="material1Finish" class="w-full p-3 border border-apple-light-border rounded-lg focus:ring-apple-blue focus:border-apple-blue transition duration-150 ease-in-out">
                            <option value="" disabled selected>Select Type First</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Customisable Material 2 (IJ) -->
            <div class="mb-6 p-4 border border-apple-light-border rounded-lg bg-apple-section">
                <h3 class="text-md font-semibold text-apple-dark mb-3">Customisable Material 2 (IJ) <span class="text-gray-500 text-sm">(Optional)</span></h3>
                <div class="flex flex-col sm:flex-row gap-4">
                    <div class="flex-1">
                        <label for="material2Type" class="block text-sm font-medium text-apple-medium mb-1">Material Type (I)</label>
                        <select id="material2Type" class="w-full p-3 border border-apple-light-border rounded-lg focus:ring-apple-blue focus:border-apple-blue transition duration-150 ease-in-out">
                            <option value="" disabled selected>Loading Materials...</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label for="material2Finish" class="block text-sm font-medium text-apple-medium mb-1">Material Finish (J)</label>
                        <select id="material2Finish" class="w-full p-3 border border-apple-light-border rounded-lg focus:ring-apple-blue focus:border-apple-blue transition duration-150 ease-in-out">
                            <option value="" disabled selected>Select Type First</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Generated SKU and Action Buttons -->
            <div class="flex flex-col sm:flex-row items-center gap-4 bg-apple-section p-4 rounded-lg border border-apple-light-border">
                <div class="flex-1">
                    <p class="text-sm text-gray-500 mb-1">Generated SKU</p>
                    <div id="generatedSku" class="font-mono text-lg text-apple-dark bg-white p-3 rounded-lg border border-apple-light-border break-words w-full text-center">
                        SKU-CODE
                    </div>
                    <p id="generatedDescription" class="mt-2 text-sm text-apple-medium text-center italic"></p>
                </div>
                <div class="flex flex-shrink-0 gap-2">
                    <button id="generateSkuBtn" class="px-5 py-3 bg-apple-primary text-white rounded-lg font-semibold shadow-md hover:bg-apple-primary-dark transition duration-150 ease-in-out">
                        Generate SKU
                    </button>
                    <button id="copySkuBtn" class="px-5 py-3 bg-gray-200 text-gray-800 rounded-lg shadow-md hover:bg-gray-300 transition duration-150 ease-in-out">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Sidebar for Legend and History -->
        <div class="sidebar-container">
            <!-- Material Legend -->
            <div class="bg-apple-light p-6 rounded-xl shadow-lg w-full border border-apple-light-border overflow-auto">
                <h2 class="text-xl font-bold text-apple-dark mb-4">Material & Finish Legend</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-apple-light-border">
                        <thead class="bg-apple-section">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-semibold text-apple-medium uppercase tracking-wider">Material</th>
                                <th class="px-4 py-2 text-left text-xs font-semibold text-apple-medium uppercase tracking-wider">Finishes</th>
                            </tr>
                        </thead>
                        <tbody id="legendTableBody" class="bg-white divide-y divide-apple-light-border">
                            <!-- Material and finish rows will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- SKU History -->
            <div class="bg-apple-light p-6 rounded-xl shadow-lg w-full border border-apple-light-border overflow-auto">
                <h2 class="text-xl font-bold text-apple-dark mb-4">SKU History</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-apple-light-border">
                        <thead class="bg-apple-section">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-semibold text-apple-medium uppercase tracking-wider">SKU</th>
                                <th class="px-4 py-2 text-left text-xs font-semibold text-apple-medium uppercase tracking-wider">Description</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody" class="bg-white divide-y divide-apple-light-border">
                            <!-- SKU history rows will be populated here -->
                        </tbody>
                    </table>
                </div>
                <p class="text-xs text-gray-500 mt-4">Note: This history is temporary and will be cleared when the page is refreshed.</p>
            </div>
        </div>
    </div>

    <!-- Custom Alert Modal -->
    <div id="customAlert" class="fixed inset-0 flex items-center justify-center bg-gray-600 bg-opacity-50 hidden">
        <div class="bg-white rounded-lg p-6 shadow-xl">
            <p id="alertMessage" class="text-lg text-gray-800"></p>
            <div class="mt-4 text-right">
                <button id="alertCloseBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md">OK</button>
            </div>
        </div>
    </div>

    <script>
        let products = [];
        let materials = [];
        let productDetails = [];
        let skus = [];

        // Element references
        let productCategorySelect, productCodeSelect, sizeTypeInput, material1TypeSelect, material1FinishSelect, material2TypeSelect, material2FinishSelect;
        let generateSkuBtn, copySkuBtn;
        let generatedSkuEl, generatedDescriptionEl;
        let legendTableBody, historyTableBody, productDetailsSection;
        let customAlert, alertMessage, alertCloseBtn;

        const showCustomAlert = (message) => {
            alertMessage.textContent = message;
            customAlert.classList.remove('hidden');
        };

        const copyToClipboard = (text) => {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            showCustomAlert('SKU copied to clipboard!');
        };

        const populateSelect = (selectElement, items, placeholder) => {
            selectElement.innerHTML = `<option value="" disabled selected>${placeholder}</option>`;
            items.forEach(item => {
                const option = document.createElement('option');
                option.value = item.code;
                option.textContent = `${item.code} - ${item.name}`;
                selectElement.appendChild(option);
            });
        };

        const populateMaterialFinishes = (materialTypeSelect, materialFinishSelect, placeholder) => {
            const selectedMaterialCode = materialTypeSelect.value;
            materialFinishSelect.innerHTML = `<option value="" disabled selected>${placeholder}</option>`;
            if (selectedMaterialCode) {
                const material = materials.find(m => m.code === selectedMaterialCode);
                if (material && material.finishes) {
                    material.finishes.forEach(finish => {
                        const option = document.createElement('option');
                        option.value = finish.code;
                        option.textContent = `${finish.code} - ${finish.name}`;
                        materialFinishSelect.appendChild(option);
                    });
                }
            }
        };

        const updateProductDetails = (productCode) => {
            const details = productDetails.find(p => p.code === productCode);
            productDetailsSection.innerHTML = '';
            if (details) {
                let html = `<p class="font-bold">Available Sizes/Types for ${details.name}:</p>`;
                html += '<ul>';
                details.sizes.forEach(size => {
                    html += `<li><strong class="font-mono text-apple-dark">${size.code}</strong>: ${size.name}</li>`;
                });
                html += '</ul>';
                productDetailsSection.innerHTML = html;
                productDetailsSection.classList.remove('hidden');
            } else {
                productDetailsSection.classList.add('hidden');
            }
        };

        const generateSku = () => {
            const productCategory = productCategorySelect.value;
            const productCode = productCodeSelect.value;
            let sizeType = sizeTypeInput.value;
            const material1Type = material1TypeSelect.value;
            const material1Finish = material1FinishSelect.value;
            const material2Type = material2TypeSelect.value;
            const material2Finish = material2FinishSelect.value;

            if (!productCategory || !productCode || !sizeType) {
                showCustomAlert('Please select a product category, code, and size/type.');
                return;
            }
            
            // Format sizeType to be a 2-digit number
            sizeType = sizeType.padStart(2, '0');

            let sku = `${productCategory}-${productCode}-${sizeType}`;
            let description = '';

            const product = products.find(p => p.code === productCode);
            if(product) {
                description += `${product.name}`;
            }

            if (material1Type && material1Finish) {
                sku += `-${material1Type}${material1Finish}`;
                const m1 = materials.find(m => m.code === material1Type);
                const f1 = m1.finishes.find(f => f.code === material1Finish);
                if(m1 && f1) {
                     description += ` in ${m1.name} with ${f1.name} finish`;
                }

                if (material2Type && material2Finish) {
                    sku += `-${material2Type}${material2Finish}`;
                    const m2 = materials.find(m => m.code === material2Type);
                    const f2 = m2.finishes.find(f => f.code === material2Finish);
                    if(m2 && f2) {
                        description += ` and ${m2.name} with ${f2.name} finish`;
                    }
                }
            } else if (material2Type || material2Finish) {
                showCustomAlert('Please select both a Material 1 Type and Finish before selecting Material 2.');
                return;
            }

            generatedSkuEl.textContent = sku;
            generatedDescriptionEl.textContent = description;
            
            // Add to history
            skus.push({ sku: sku, description: description });
            updateHistoryTable();
        };

        const updateHistoryTable = () => {
            historyTableBody.innerHTML = '';
            skus.forEach(item => {
                const row = `
                    <tr class="hover:bg-gray-100">
                        <td class="px-4 py-2 whitespace-nowrap text-sm font-medium text-apple-dark">${item.sku}</td>
                        <td class="px-4 py-2 text-sm text-apple-medium break-words">${item.description}</td>
                    </tr>
                `;
                historyTableBody.insertAdjacentHTML('beforeend', row);
            });
        };

        const populateLegend = () => {
            legendTableBody.innerHTML = '';
            materials.forEach(material => {
                const finishes = material.finishes.map(f => `${f.code} - ${f.name}`).join(', ');
                const row = `
                    <tr>
                        <td class="px-4 py-2 whitespace-nowrap text-sm font-medium text-apple-dark">${material.code} - ${material.name}</td>
                        <td class="px-4 py-2 text-sm text-apple-medium break-words">${finishes}</td>
                    </tr>
                `;
                legendTableBody.insertAdjacentHTML('beforeend', row);
            });
        };

        const fetchAndPopulateData = async () => {
            try {
                // Fetch products data
                const productsResponse = await fetch('products.json');
                products = await productsResponse.json();
                populateSelect(productCodeSelect, products, 'Product Code');

                // Fetch materials data
                const materialsResponse = await fetch('materials.json');
                materials = await materialsResponse.json();
                populateSelect(material1TypeSelect, materials, 'Select Type');
                populateSelect(material2TypeSelect, materials, 'Select Type');

                // Fetch product details data
                const productDetailsResponse = await fetch('product_details.json');
                productDetails = await productDetailsResponse.json();
                
                populateLegend();
            } catch (e) {
                console.error("Error fetching data:", e);
                showCustomAlert("Error loading product and material data. Please check if the files exist.");
            }
        };

        // Main function to run the application
        const runApplication = () => {
            // Get element references
            productCategorySelect = document.getElementById('productCategory');
            productCodeSelect = document.getElementById('productCode');
            sizeTypeInput = document.getElementById('sizeType');
            material1TypeSelect = document.getElementById('material1Type');
            material1FinishSelect = document.getElementById('material1Finish');
            material2TypeSelect = document.getElementById('material2Type');
            material2FinishSelect = document.getElementById('material2Finish');
            generateSkuBtn = document.getElementById('generateSkuBtn');
            copySkuBtn = document.getElementById('copySkuBtn');
            generatedSkuEl = document.getElementById('generatedSku');
            generatedDescriptionEl = document.getElementById('generatedDescription');
            legendTableBody = document.getElementById('legendTableBody');
            historyTableBody = document.getElementById('historyTableBody');
            productDetailsSection = document.getElementById('productDetailsSection');
            customAlert = document.getElementById('customAlert');
            alertMessage = document.getElementById('alertMessage');
            alertCloseBtn = document.getElementById('alertCloseBtn');

            // Add event listeners
            productCodeSelect.addEventListener('change', () => {
                updateProductDetails(productCodeSelect.value);
            });
            material1TypeSelect.addEventListener('change', () => {
                populateMaterialFinishes(material1TypeSelect, material1FinishSelect, 'Select Finish');
            });
            material2TypeSelect.addEventListener('change', () => {
                populateMaterialFinishes(material2TypeSelect, material2FinishSelect, 'Select Finish');
            });
            generateSkuBtn.addEventListener('click', generateSku);
            copySkuBtn.addEventListener('click', () => copyToClipboard(generatedSkuEl.textContent));
            alertCloseBtn.addEventListener('click', () => customAlert.classList.add('hidden'));

            // Fetch and populate data on load
            fetchAndPopulateData();
        };

        // Call the main function when the window loads
        window.onload = runApplication;
    </script>
</body>
</html>
